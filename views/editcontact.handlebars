<html>
	<head>
		<!-- Google Analytics -->
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-135347833-1', 'auto');
			ga('send', 'pageview');
		</script>
		<!-- End Google Analytics -->
		<title> Card Connect </title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="/css/newcontact.css">
		<script src="https://code.jquery.com/jquery-3.1.0.js"></script>
		<script>
			$(document).ready(function(){
				$('#change-pic').submit(function(){
					console.log('i was clicked');
					$('.header img').attr('src', '/images/placeholder.png');
				});
			});
		</script>
	</head>
	<body>
		<div class="top-bar">
			<h3 style="text-align: center;">Edit Card</h3>
			<a href="javascript:history.back()" class="cancel-button">Cancel</a>
		</div>
		<form class="new-contact" role="form" method="post" action="/existingcontact/{{data.fullName}}">
			<div class="header-img">
				<object id="display-card-1" data="/images/template-{{data.template}}.svg" type="image/svg+xml" class="card">Your browser does not support SVG</object>
				<object id="" data="" type="image/svg+xml" class="hide"></object>
				<button type="button" class="prev" onclick="changeSlide(-1)">&#10094;</button>
				<button type="button" class="next" onclick="changeSlide(1)">&#10095;</button>
				<input id="template" type="number" name="template" style="display: none;">
			</div>
			<div class="header-text">
				<input id="first" type="text" name="first" value="{{data.first}}" required><br>
				<input id="last" type="text" name="last" value="{{data.last}}" required>
			</div>

			<div class="body">
				<div class="input-field">
					<img src="/images/icon-call.svg">
					<input id="phone" type="number" class="new" name="phone" value="{{data.phone}}">
				</div><br>

				<div class="input-field">
					<img src="/images/icon-company.svg">
					<input id="company" type="text" class="new" name="company" value="{{data.company}}">
				</div><br>

				<div class="input-field">
					<img src="/images/icon-globe.svg">
					<input id="website" type="text" class="new" name="website" value="{{data.website}}">
				</div><br>

				<div class="input-field">
					<img src="/images/icon-mail.svg">
					<input id="email" type="email" class="new" name="email" value="{{data.email}}">
				</div><br>

				<div class="input-field">
					<img src="/images/icon-home.svg">
					<input id="line1" type="text" class="new" name="line1" value="{{data.line1}}"><br>
					<input id="line2" type="text" class="new" name="line2" value="{{data.line2}}">
				</div><br>

				<input class="done-button" type="submit" value="Done">

				<a href="/deletecontact/{{data.fullName}}" onclick="return confirm('Are you sure?')" class="delete-button">Delete</a>
			</div>
		</form>

		<script>
			window.onload=function() {
				loadCard();
				updateCard();
				loadTemplates();
			};

			function loadCard() {
				var a = document.getElementsByClassName("card")[0];
				var svgDoc = a.contentDocument;	
				var first = svgDoc.getElementById("first");
				var last = svgDoc.getElementById("last");
				var phone = svgDoc.getElementById("phone");
				var company = svgDoc.getElementById("company");
				var website = svgDoc.getElementById("website");
				var email = svgDoc.getElementById("email");
				var line1 = svgDoc.getElementById("line1");
				var line2 = svgDoc.getElementById("line2");
				if (first == null) {
					setInterval("loadCard()", 100);
				} else {
					first.textContent = $("#first").val();
					last.textContent = $("#last").val();
					phone.textContent = $("#phone").val();
					company.textContent = $("#company").val();
					website.textContent = $("#website").val();
					email.textContent = $("#email").val();
					line1.textContent = $("#line1").val();
					line2.textContent = $("#line2").val();
				}
			}


			function updateCard() {
				$("input").keyup(function() {
					var a = document.getElementsByClassName("card")[0];
					var svgDoc = a.contentDocument;
					var svgElement = svgDoc.getElementById(this.id);
					svgElement.textContent = $(this).val();
				});
			}
			
			function changeSlide(n) {
				var currentId = document.getElementsByClassName("card")[0].id;
				var currentSlide = parseInt(currentId.substring(currentId.length - 1, currentId.length));
				var newSlide = currentSlide + n
				if (newSlide == 0) {
					newSlide = 4;
				} else if (newSlide == 5) {
					newSlide = 1;
				}
				document.getElementById("display-card-" + newSlide).classList.add("card");
				document.getElementById("display-card-" + newSlide).classList.remove("hide");
				document.getElementById("display-card-" + currentSlide).classList.remove("card");
				document.getElementById("display-card-" + currentSlide).classList.add("hide");
				$("#template").val(newSlide);
				loadCard();
			}
			
			function loadTemplates() {
				var currentId = document.getElementsByClassName("card")[0].id;
				var currentSlide = parseInt(currentId.substring(currentId.length - 1, currentId.length));
				var k;
				for (k = 1; k < 5; k++) {
					if (k == currentSlide) {
						
					} else {
						$(".header-img").prepend('<object id="display-card-' + k + '" data="/images/template-' + k + '.svg" type="image/svg+xml" class="hide">Your browser does not support SVG</object>');
					}
				}
			}
		</script>
	</body>
</html>
